// ... existing middleware code can stay exactly the same ...
